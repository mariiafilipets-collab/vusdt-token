# Настройка функции обратной конвертации VUSDT → USDT

## Описание

Добавлена возможность конвертации VUSDT обратно в USDT:
- Конвертация занимает **14 дней**
- На заблокированные токены **не начисляются проценты**
- Заявки обрабатываются вручную администратором
- Статус заявки обновляется в реальном времени

## Шаги настройки

### 1. Настройка переменных окружения

Добавьте в `.env` в корне проекта:

```env
# Адрес кошелька для хранения USDT для конвертаций
TREASURY_WALLET_ADDRESS=0xВашАдресКошелька
```

**Важно:** Это должен быть кошелек, где хранятся USDT для выплат при конвертации.

### 2. Развертывание контракта

```bash
npm run deploy:testnet
```

Контракт `ConversionRequest` будет автоматически развернут, если указан `USDT_TOKEN_ADDRESS`.

### 3. Настройка фронтенда

Добавьте в `frontend/.env`:

```env
REACT_APP_CONVERSION_CONTRACT_ADDRESS=0xАдресConversionКонтракта
```

Адрес контракта можно найти в `deployment-info.json` после развертывания.

### 4. Перезапуск фронтенда

```bash
cd frontend
npm start
```

## Как это работает

### Для пользователя:

1. **Создание заявки:**
   - Пользователь вводит количество VUSDT для конвертации
   - Токены блокируются на 14 дней
   - Заявка получает статус "Pending"

2. **Ожидание:**
   - В течение 14 дней токены заблокированы
   - На заблокированные токены не начисляются проценты
   - Пользователь видит статус заявки и оставшиеся дни

3. **Обработка:**
   - После 14 дней заявка готова к обработке
   - Администратор вручную переводит USDT пользователю
   - Администратор помечает заявку как "Completed"

### Для администратора:

1. **Просмотр заявок:**
   - Все заявки отображаются в админ панели
   - Видны статусы: Pending, Processing, Completed, Cancelled
   - Показаны оставшиеся дни до готовности

2. **Обработка:**
   - Можно пометить заявку как "Processing"
   - После ручного перевода USDT - пометить как "Completed"
   - Можно отменить заявку (токены вернутся пользователю)

## Статусы заявок

- **Pending** - Заявка создана, ожидает обработки (14 дней)
- **Processing** - Администратор обрабатывает заявку
- **Completed** - Конвертация завершена, USDT переведен
- **Cancelled** - Заявка отменена, токены возвращены

## Важные замечания

1. **Блокировка токенов:**
   - Токены переводятся на адрес контракта ConversionRequest
   - На заблокированные токены не начисляются проценты
   - После завершения конвертации токены остаются в контракте (могут быть сожжены позже)

2. **Ручная обработка:**
   - Администратор должен вручную перевести USDT пользователю
   - Только после этого помечать заявку как "Completed"
   - Рекомендуется проверять адрес получателя перед переводом

3. **Безопасность:**
   - Только владелец контракта может обрабатывать заявки
   - Заявки нельзя завершить раньше 14 дней
   - Отмена заявки возвращает токены пользователю

## Функции контракта

- `requestConversion(uint256)` - создать заявку на конвертацию
- `markAsProcessing(uint256)` - пометить как обрабатываемую (admin)
- `completeConversion(uint256)` - завершить конвертацию (admin)
- `cancelRequest(uint256)` - отменить заявку (admin)
- `getRequest(uint256)` - получить детали заявки
- `getUserRequests(address)` - получить заявки пользователя
- `getLockedBalance(address)` - получить заблокированный баланс

